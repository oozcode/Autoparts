{% extends 'autopart/base/header.html' %}
{% block content %}
<main>
<div style="height: 100px;"></div>
<div class="container mt-5 pt-4">
  <div class="row justify-content-center">
    <div class="col-lg-10 col-xl-9">
      <div class="bg-white rounded shadow p-4">
        <h2 class="mb-4 text-center">ðŸ‘¥ Lista de Clientes / Vendedores</h2>

        <form method="get" class="form-inline justify-content-center mb-4">
        <input type="text" name="q" placeholder="Buscar por nombre o correo" value="{{ query|default_if_none:'' }}" class="form-control mr-2 w-50">
        <select name="tipo" class="form-control mr-2">
            <option value="">Todos</option>
            <option value="mayorista" {% if tipo == 'mayorista' %}selected{% endif %}>Mayorista</option>
            <option value="minorista" {% if tipo == 'minorista' %}selected{% endif %}>Minorista</option>
        </select>
        <button type="submit" class="btn btn-primary">Buscar</button>
        </form>

        <div class="table-responsive">
          <table class="table table-striped table-hover text-center align-middle">
            <thead class="thead-dark">
              <tr>
                <th>ID</th>
                <th>Nombre Completo</th>
                <th>Email</th>
                <th>Tipo Cliente</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              {% for user in usuarios %}
              <tr>
                <td>{{ user.id }}</td>
                <td>{{ user.get_full_name }}</td>
                <td>{{ user.email }}</td>
                <td>
                  {% if user.perfilusuario.tipo_cliente %}
                    <span class="badge badge-info">{{ user.perfilusuario.tipo_cliente.nombre }}</span>
                  {% else %}
                    <span class="badge badge-secondary">Sin asignar</span>
                  {% endif %}
                </td>
                <td>
                  {% if user.perfilusuario.tipo_cliente and user.perfilusuario.tipo_cliente.nombre == 'Mayorista' %}
                    <span class="text-success font-weight-bold">âœ” Ya es Mayorista</span>
                  {% else %}
                    <a href="{% url 'asignar_tipo_cliente' user.id %}" class="btn btn-sm btn-outline-primary">
                      Asignar Mayorista
                    </a>
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
</main>
{% include 'autopart/base/footer.html' %}
{% endblock %}