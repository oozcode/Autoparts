{% extends 'autopart/base/header.html' %}
{% load static %}
{% block title %}{{ producto.nombre }} - AutoParts{% endblock %}
{% block content %}

<main class="container my-5">
  <div class="row">
    <div class="col-md-6 text-center">
      <img src="{{ producto.imagen.url|default:'/static/autopart/img/default.jpg' }}" alt="{{ producto.nombre }}">

    </div>

    <div class="col-md-6">
      <h2>{{ producto.nombre }}</h2>
      <p class="text-muted">{{ producto.descripcion }}</p>

      <h4 class="text-success fw-bold">
        Precio:
        {{ producto.precio_minorista|floatformat:0 }} CLP
      </h4>

      <div class="mt-4">
        <label for="cantidad" class="form-label">Cantidad</label>
        <input type="number" id="cantidad" value="1" min="1" max="100" class="form-control w-25" />
      </div>

      <button class="btn btn-primary mt-3" id="agregarCarrito"
              data-id="{{ producto.id }}"
              data-name="{{ producto.nombre }}"
              data-price="{{ producto.precio_minorista }}"
              data-image="{{ producto.imagen.url }}"
              data-description="{{ producto.descripcion }}">
        <i class="fas fa-cart-plus me-2"></i> Agregar al carrito
      </button>
    </div>
  </div>
</main>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const btn = document.getElementById("agregarCarrito");

    btn.addEventListener("click", () => {
      const product = {
        id: parseInt(btn.dataset.id),
        name: btn.dataset.name,
        price: parseInt(btn.dataset.price),
        image: btn.dataset.image,
        description: btn.dataset.description,
        quantity: parseInt(document.getElementById("cantidad").value)
      };

      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      const existing = cart.find(item => item.id === product.id);
      if (existing) {
        existing.quantity += product.quantity;
        if (existing.quantity > 100) existing.quantity = 100;
      } else {
        cart.push(product);
      }

      localStorage.setItem("cart", JSON.stringify(cart));
      alert("Producto agregado al carrito ðŸ›’");
    });
  });
</script>

{% endblock %}
