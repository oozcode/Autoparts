{% extends 'autopart/base/header.html' %}
{% load static %}
{% block title %}{{ producto.nombre }} - AutoParts{% endblock %}
{% block content %}

<main class="container my-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card shadow-lg border-0">
        <div class="row g-0">
          <div class="col-md-5 text-center bg-light d-flex align-items-center justify-content-center p-4">
            <img src="{{ producto.img.url|default:'/static/autopart/img/default.jpg' }}" alt="{{ producto.nombre }}" class="img-fluid rounded" style="max-height: 300px;">
          </div>
          <div class="col-md-7">
            <div class="card-body">
              <h2 class="card-title mb-3">{{ producto.nombre }}</h2>
              <p class="card-text text-muted mb-4">{{ producto.descripcion }}</p>
              <h4 class="text-success fw-bold mb-4">
                Precio: <span id="precioProducto">{{ producto.precio_minorista|floatformat:0 }}</span> CLP
              </h4>
              <div class="mb-3">
                <label for="cantidad" class="form-label">Cantidad</label>
                <input type="number" id="cantidad" value="1" min="1" max="100" class="form-control w-50" />
              </div>
              <button class="btn btn-primary btn-lg w-100" id="agregarCarrito"
                      data-id="{{ producto.id }}"
                      data-name="{{ producto.nombre }}"
                      data-price="{{ producto.precio_minorista }}"
                      data-image="{{ producto.img.url }}"
                      data-description="{{ producto.descripcion }}">
                <i class="fas fa-cart-plus me-2"></i> Agregar al carrito
              </button>
              <div class="mt-4">
                <a href="{% url 'catalogo' %}" class="btn btn-outline-secondary w-100">
                  <i class="fas fa-arrow-left me-2"></i> Volver al catÃ¡logo
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Opcional: Puedes agregar aquÃ­ detalles adicionales como stock, marca, etc. -->
    </div>
  </div>
</main>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Formato CLP para el precio
    const precio = document.getElementById("precioProducto");
    if (precio) {
      let num = Number(precio.textContent.replace(/[^0-9.-]+/g,""));
      precio.textContent = num.toLocaleString('es-CL', { style: 'currency', currency: 'CLP', minimumFractionDigits: 0 });
    }

    const btn = document.getElementById("agregarCarrito");
    btn.addEventListener("click", () => {
      const product = {
        id: parseInt(btn.dataset.id),
        name: btn.dataset.name,
        price: parseInt(btn.dataset.price),
        image: btn.dataset.image,
        description: btn.dataset.description,
        quantity: parseInt(document.getElementById("cantidad").value)
      };

      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      const existing = cart.find(item => item.id === product.id);
      if (existing) {
        existing.quantity += product.quantity;
        if (existing.quantity > 100) existing.quantity = 100;
      } else {
        cart.push(product);
      }

      localStorage.setItem("cart", JSON.stringify(cart));
      alert("Producto agregado al carrito ðŸ›’");
    });
  });
</script>
{% include 'autopart/base/footer.html' %}
{% endblock %}

