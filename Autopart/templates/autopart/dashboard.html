
{% extends 'autopart/base/header.html' %}
{% load static %}
{% block title %}Dashboard{% endblock %}
{% block content %}
<main>
<div class="container mt-5">
  <h2 class="text-center mb-4">Panel de Control üßë‚Äçüîß</h2>
<div class="row mb-3 align-items-end">
  <div class="col-md-2">
    <label for="filtroNombre" class="form-label">Nombre</label>
    <input type="text" id="filtroNombre" class="form-control" placeholder="Buscar por nombre">
  </div>
  <div class="col-md-2">
  <label for="filtroMarca" class="form-label">Marca</label>
  <div class="input-group">
    <select id="filtroMarca" class="form-control">
      <option value="">Marcas</option>
    </select>
    <button class="btn btn-outline-primary" type="button" id="btnNuevaMarca" title="Agregar nueva marca">+</button>
  </div>
</div>
<div class="col-md-2">
  <label for="filtroCategoria" class="form-label">Categor√≠a</label>
  <div class="input-group">
    <select id="filtroCategoria" class="form-control">
      <option value="">Categor√≠as</option>
    </select>
    <button class="btn btn-outline-primary" type="button" id="btnNuevaCategoria" title="Agregar nueva categor√≠a">+</button>
  </div>
</div>
<div class="col-md-3">
  <label for="filtroMarcaAuto" class="form-label">Marca de Auto</label>
  <div class="input-group">
    <select id="filtroMarcaAuto" class="form-control">
      <option value="">Marcas de auto</option>
    </select>
    <button class="btn btn-outline-primary" type="button" id="btnNuevaMarcaAuto" title="Agregar nueva marca de auto">+</button>
  </div>
</div>
  <div class="col-md-2">
    <label for="filtroStock" class="form-label">Stock</label>
    <select id="filtroStock" class="form-control">
      <option value="">Stock</option>
      <option value="con">Con stock</option>
      <option value="sin">Sin stock</option>
    </select>
  </div>
  <div class="col-md-2">
  <label for="filtroPrecioMin" class="form-label">Precio M√≠nimo</label>
  <input type="number" id="filtroPrecioMin" class="form-control" placeholder="M√≠nimo">
    </div>
    <div class="col-md-2">
      <label for="filtroPrecioMax" class="form-label">Precio M√°ximo</label>
      <input type="number" id="filtroPrecioMax" class="form-control" placeholder="M√°ximo">
    </div>
    <div class="col-md-2">
      <label for="filtroPrecioMayoristaMin" class="form-label">Precio Mayorista M√≠nimo</label>
      <input type="number" id="filtroPrecioMayoristaMin" class="form-control" placeholder="M√≠nimo">
    </div>
    <div class="col-md-2">
      <label for="filtroPrecioMayoristaMax" class="form-label">Precio Mayorista M√°ximo</label>
      <input type="number" id="filtroPrecioMayoristaMax" class="form-control" placeholder="M√°ximo">
    </div>
  <div class="col-md-1 d-grid">
    <label class="form-label" style="visibility:hidden;">Limpiar</label>
    <button class="btn btn-outline-secondary" id="btnLimpiarFiltros" title="Limpiar filtros">Limpiar</button>
  </div>
</div>
  <div class="d-flex justify-content-end gap-2 mb-3">
  <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#crearModal">‚ûï Crear Producto</button>
  <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalGestionCategoria">üõ†Ô∏è Editar Categor√≠as</button>
</div>

  <div class="table-responsive">
    <table class="table table-dashboard align-middle" id="tablaProductos">
      <thead>
        <tr>
          <th>ID</th>
          <th>Imagen</th>
          <th>Nombre</th>
          <th>Precio Minorista</th>
          <th>Precio Mayorista</th>
          <th>Marca</th>
          <th>Categor√≠a</th>
          <th>Marcas de Auto</th>
          <th>Stock</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="productosBody">
        <!-- Aqu√≠ se insertar√°n los productos v√≠a JS -->
      </tbody>
    </table>
  </div>
</div>

<!-- Modal Crear Producto -->
<div class="modal fade" id="crearModal" tabindex="-1" aria-labelledby="crearModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form id="formCrearProducto" enctype="multipart/form-data">
        <div class="modal-header">
          <h5 class="modal-title" id="crearModalLabel">Crear nuevo producto</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <!-- Mejor estructura para el formulario del modal -->
        <div class="modal-body">
          <!-- Informaci√≥n b√°sica -->
          <h6 class="mt-2 mb-1 text-primary">Informaci√≥n b√°sica</h6>
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Nombre</label>
              <input type="text" class="form-control" name="nombre" required placeholder="Ej: Filtro de aire">
            </div>
            <div class="col-md-6">
              <label class="form-label">Imagen</label>
              <input type="file" class="form-control" name="imagen" accept="image/*">
            </div>
            <div class="col-12">
              <label class="form-label">Descripci√≥n</label>
              <textarea class="form-control" name="descripcion" rows="2" required placeholder="Describe el producto..."></textarea>
            </div>
          </div>

          <!-- Precios y Stock -->
          <h6 class="mt-4 mb-1 text-primary">Precios y Stock</h6>
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">Precio Minorista</label>
              <input type="number" class="form-control" name="precio_minorista" required placeholder="Ej: 19990">
            </div>
            <div class="col-md-4">
              <label class="form-label">Precio Mayorista</label>
              <input type="number" class="form-control" name="precio_mayorista" required placeholder="Ej: 15990">
            </div>
            <div class="col-md-4">
              <label class="form-label">Stock</label>
              <input type="number" class="form-control" name="stock" required placeholder="Ej: 10">
            </div>
          </div>

          <!-- Dimensiones y Peso -->
          <h6 class="mt-4 mb-1 text-primary">Dimensiones y Peso</h6>
          <div class="row g-3">
            <div class="col-md-3">
              <label class="form-label">Peso (kg)</label>
              <input type="number" class="form-control" name="peso" step="0.01" placeholder="Ej: 1.2">
            </div>
            <div class="col-md-3">
              <label class="form-label">Largo (cm)</label>
              <input type="number" class="form-control" name="largo" step="0.01" placeholder="Ej: 30">
            </div>
            <div class="col-md-3">
              <label class="form-label">Ancho (cm)</label>
              <input type="number" class="form-control" name="ancho" step="0.01" placeholder="Ej: 15">
            </div>
            <div class="col-md-3">
              <label class="form-label">Alto (cm)</label>
              <input type="number" class="form-control" name="alto" step="0.01" placeholder="Ej: 10">
            </div>
          </div>

          <!-- Compatibilidad -->
          <h6 class="mt-4 mb-1 text-primary">Compatibilidad</h6>
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Marcas de Auto</label>
              <select name="marcas_auto" class="form-select" multiple required style="min-height: 90px"></select>
              <small class="text-muted">Mant√©n presionada Ctrl (o Cmd) para seleccionar varias.</small>
            </div>
            <div class="col-md-3">
              <label class="form-label">Categor√≠a</label>
              <select name="categoria" class="form-select" required></select>
            </div>
            <div class="col-md-3">
              <label class="form-label">Marca</label>
              <select name="marca" class="form-select" required></select>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Crear</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal Editar Producto -->
<!-- Modal Editar Producto -->
<div class="modal fade" id="editarModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form id="formEditarProducto" enctype="multipart/form-data">
        <div class="modal-header">
          <h5 class="modal-title">Editar producto</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <!-- Informaci√≥n b√°sica -->
          <h6 class="mt-2 mb-1 text-primary">Informaci√≥n b√°sica</h6>
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Nombre</label>
              <input type="text" class="form-control" name="nombre" required placeholder="Ej: Filtro de aire">
            </div>
            <div class="col-md-6">
              <label class="form-label">Imagen</label>
              <input type="file" class="form-control" name="imagen" accept="image/*">
            </div>
            <div class="col-12">
              <label class="form-label">Descripci√≥n</label>
              <textarea class="form-control" name="descripcion" rows="2" required placeholder="Describe el producto..."></textarea>
            </div>
          </div>

          <!-- Precios y Stock -->
          <h6 class="mt-4 mb-1 text-primary">Precios y Stock</h6>
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">Precio Minorista</label>
              <input type="number" class="form-control" name="precio_minorista" required placeholder="Ej: 19990">
            </div>
            <div class="col-md-4">
              <label class="form-label">Precio Mayorista</label>
              <input type="number" class="form-control" name="precio_mayorista" required placeholder="Ej: 15990">
            </div>
            <div class="col-md-4">
              <label class="form-label">Stock</label>
              <input type="number" class="form-control" name="stock" required placeholder="Ej: 10">
            </div>
            <div class="col-md-4">
              <div class="form-check mt-4">
                <input class="form-check-input" type="checkbox" id="ofertaEditar" name="en_oferta">
                <label class="form-check-label" for="ofertaEditar">¬øProducto en oferta?</label>
              </div>
            </div>
            <div class="col-md-4">
              <label class="form-label">Descuento (%)</label>
              <input type="number" class="form-control" name="descuento" id="descuentoEditar" min="1" max="99" placeholder="Ej: 20" disabled>
            </div>
            <div class="col-md-4">
              <label class="form-label">Precio con Descuento</label>
              <input type="text" class="form-control" id="precioConDescuentoEditar" readonly placeholder="$0">
            </div>
          </div>

          <!-- Dimensiones y Peso -->
          <h6 class="mt-4 mb-1 text-primary">Dimensiones y Peso</h6>
          <div class="row g-3">
            <div class="col-md-3">
              <label class="form-label">Peso (kg)</label>
              <input type="number" class="form-control" name="peso" step="0.01" placeholder="Ej: 1.2">
            </div>
            <div class="col-md-3">
              <label class="form-label">Largo (cm)</label>
              <input type="number" class="form-control" name="largo" step="0.01" placeholder="Ej: 30">
            </div>
            <div class="col-md-3">
              <label class="form-label">Ancho (cm)</label>
              <input type="number" class="form-control" name="ancho" step="0.01" placeholder="Ej: 15">
            </div>
            <div class="col-md-3">
              <label class="form-label">Alto (cm)</label>
              <input type="number" class="form-control" name="alto" step="0.01" placeholder="Ej: 10">
            </div>
          </div>

          <!-- Compatibilidad -->
          <h6 class="mt-4 mb-1 text-primary">Compatibilidad</h6>
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Marcas de Auto</label>
              <select name="marcas_auto" class="form-select" multiple required style="min-height: 90px"></select>
              <small class="text-muted">Mant√©n presionada Ctrl (o Cmd) para seleccionar varias.</small>
            </div>
            <div class="col-md-3">
              <label class="form-label">Categor√≠a</label>
              <select name="categoria" class="form-select" required></select>
            </div>
            <div class="col-md-3">
              <label class="form-label">Marca</label>
              <select name="marca" class="form-select" required></select>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Guardar cambios</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal para agregar nueva entidad -->
<div class="modal fade" id="modalNuevaEntidad" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="formNuevaEntidad">
        <div class="modal-header">
          <h5 class="modal-title" id="tituloModalNuevaEntidad">Agregar nuevo</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="text" class="form-control" id="inputNuevaEntidad" required placeholder="Nombre">
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Agregar</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        </div>
      </form>
    </div>
  </div>
</div>
<div class="modal fade" id="modalGestionCategoria" tabindex="-1" aria-labelledby="modalGestionCategoriaLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Gestionar Categor√≠as</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div id="listaCategorias" class="d-flex flex-column gap-3">
          <!-- Las categor√≠as se insertar√°n din√°micamente aqu√≠ -->
        </div>
      </div>
    </div>
  </div>
</div>
</main>
<style>
/* Tabla moderna y agradable */
.table-dashboard {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 2px 16px rgba(0,0,0,0.06);
  overflow: hidden;
}
.table-dashboard th, .table-dashboard td {
  vertical-align: middle !important;
  text-align: center;
}
.table-dashboard th {
  background: #212529;
  color: #fff;
  font-weight: 600;
  font-size: 1.05rem;
  border: none;
}
.table-dashboard tr {
  transition: background 0.12s;
}
.table-dashboard tbody tr:hover {
  background: #f1f3f5;
}
.table-dashboard td {
  border-top: 1px solid #e9ecef;
  font-size: 0.98rem;
}
.table-dashboard img {
  width: 56px;
  height: 56px;
  object-fit: contain;
  border-radius: 7px;
  border: 1px solid #eee;
  background: #fafafa;
}
.dashboard-action-btns .btn {
  margin: 0 2px;
  font-size: 0.98rem;
  padding: 0.35rem 0.7rem;
  border-radius: 6px;
}
.dashboard-action-btns .btn-edit {
  background: #198754;
  color: #fff;
}
.dashboard-action-btns .btn-edit:hover {
  background: #146c43;
}
.dashboard-action-btns .btn-delete {
  background: #dc3545;
  color: #fff;
}
.dashboard-action-btns .btn-delete:hover {
  background: #b52a37;
}
@media (max-width: 768px) {
  .table-dashboard th, .table-dashboard td {
    font-size: 0.93rem;
    padding: 0.4rem;
  }
  .table-dashboard img {
    width: 40px;
    height: 40px;
  }
}
</style>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="{% static 'autopart/js/dashboard.js' %}"></script>
{% include 'autopart/base/footer.html' %}
{% endblock %}
